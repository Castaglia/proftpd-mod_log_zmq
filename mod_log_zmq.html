<html>
<head>
<title>ProFTPD module mod_log_zmq</title>
</head>

<body bgcolor=white>

<hr>
<center>
<h2><b>ProFTPD module <code>mod_log_zmq</code></b></h2>
</center>
<hr><br>

This module is contained in the <code>mod_log_zmq.c</code> file for
ProFTPD 1.3.<i>x</i>, and is not compiled by default.  Installation
instructions are discussed <a href="#Installation">here</a>.

<p>
The purpose of the <code>mod_log_zmq</code> module is to

<p>
The <code>mod_log_zmq</code> module uses the <code>zmq</code> and
<code>czmq</code> libraries from ...

<p>
The most current version of <code>mod_log_zmq</code> can be found at:
<pre>
  <a href="https://github.com/Castaglia/proftpd-mod_log_zmq.git">https://github.com/Castaglia/proftpd-mod_log_zmq.git</a>
</pre>

<h2>Author</h2>
<p>
Please contact TJ Saunders &lt;tj <i>at</i> castaglia.org&gt; with any
questions, concerns, or suggestions regarding this module.

<h2>Directives</h2>
<ul>
  <li><a href="#LogZMQDeliveryMode">LogZMQDeliveryMode</a>
  <li><a href="#LogZMQEndpoint">LogZMQEndpoint</a>
  <li><a href="#LogZMQEngine">LogZMQEngine</a>
  <li><a href="#LogZMQLog">LogZMQLog</a>
  <li><a href="#LogZMQMaxPendingMessages">LogZMQMaxPendingMessages</a>
  <li><a href="#LogZMQMessageFormat">LogZMQMessageFormat</a>
  <li><a href="#LogZMQTimeout">LogZMQTimeout</a>
</ul>

<p>
<hr>
<h2><a name="LogZMQDeliveryMode">LogZMQDeliveryMode</a></h2>
<strong>Syntax:</strong> LogZMQDeliveryMode <em>"optimistic"|"guaranteed"</em><br>
<strong>Default:</strong> LogZMQDeliveryMode optimistic<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQDeliveryMode</code> directive

  optimistic: PUB/SUB
  guaranteed: PUSH/PULL

  http://zguide.zeromq.org/page:all#Pros-and-Cons-of-Pub-Sub

<p>
<hr>
<h2><a name="LogZMQEndpoint">LogZMQEndpoint</a></h2>
<strong>Syntax:</strong> LogZMQEndpoint <em>address format-name</em><br>
<strong>Default:</strong> None<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQEndpoint</code> directive

<p>
<hr>
<h2><a name="LogZMQEngine">LogZMQEngine</a></h2>
<strong>Syntax:</strong> LogZMQEngine <em>on|off</em><br>
<strong>Default:</strong> None<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQEngine</code> directive is used to specify a log file for
<code>mod_sql</code> reporting and debugging, and can be done a per-server
basis.  The <em>file</em> parameter must be the full path to the file to use for
logging.

<p>
If <em>file</em> is &quot;none&quot;, no logging will be done at all; this
setting can be used to override a <code>LogZMQLog</code> setting inherited from
a <code>&lt;Global&gt;</code> context.

<p>
<hr>
<h2><a name="LogZMQLog">LogZMQLog</a></h2>
<strong>Syntax:</strong> LogZMQLog <em>file|"none"</em><br>
<strong>Default:</strong> None<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQLog</code> directive is used to specify a log file for
<code>mod_log_zmq</code>'s reporting on a per-server basis.  The <em>file</em>
parameter given must be the full path to the file to use for logging.

<p>
<hr>
<h2><a name="LogZMQMaxPendingMessages">LogZMQMaxPendingMessages</a></h2>
<strong>Syntax:</strong> LogZMQMaxPendingMessages <em>count</em><br>
<strong>Default:</strong> None<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQMaxPendingMessages</code> directive (ZMQ_SNDHWM)

<p>
<hr>
<h2><a name="LogZMQMessageFormat">LogZMQMessageFormat</a></h2>
<strong>Syntax:</strong> LogZMQMessageFormat <em>"json"</em><br>
<strong>Default:</strong> LogZMQMessagerFormat json<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQMessageFormat</code> directive

<p>
<hr>
<h2><a name="LogZMQTimeout">LogZMQTimeout</a></h2>
<strong>Syntax:</strong> LogZMQTimeout <em>millisecs</em><br>
<strong>Default:</strong> LogZMQTimeout 500<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_log_zmq<br>
<strong>Compatibility:</strong> 1.3.5rc4 and later

<p>
The <code>LogZMQTimeout</code> directive (ZMQ_SNDTIMEO)

<p>
<hr>
<h2><a name="Installation">Installation</a></h2>
To install <code>mod_log_zmq</code>, go to the third-party module area in
the proftpd source code and unpack the <code>mod_log_zmq</code> source tarball:
<pre>
  cd <i>proftpd-dir</i>/contrib/
  tar zxvf /path/to/mod_log_zmq-<i>version</i>.tar.gz
</pre>
after unpacking the latest proftpd-1.3.4 (or later) source code.  For including
<code>mod_log_zmq</code> as a staticly linked module:
<pre>
  ./configure --with-modules=mod_log_zmq
</pre>
Alternatively, <code>mod_log_zmq</code> can be built as a DSO module:
<pre>
  ./configure --enable-dso --with-shared=mod_log_zmq ...
</pre>

<p>
You will also need to tell <code>configure</code> how to find the ZeroMQ
libraries and header files:
<pre>
  ./configure --with-modules=mod_log_zmq \
    --with-includes=<i>/path/to/zmq/include:/path/to/czmq/include \
    --with-libraries=<i>/path/to/zmq/lib:/path/to/czmq/lib</i>
</pre>

<p>
Then follow the usual steps:
<pre>
  make
  make install
</pre>

<p>
<hr>
<h2><a name="Usage">Usage</a></h2>

Example configuration:
<pre>
  &lt;IfModule mod_log_zmq.c&gt;
    LogFormat json "%u: %m (%b) [%T] %{iso8601}"

    LogZMQDeliveryMode guaranteed
    LogZMQEngine on
    LogZMQLog /var/log/ftpd/log_zmq.log
    LogZMQEndpoint tcp://*:7777 json
  &lt;/IfModule&gt;
</pre>

<p><a name="VariableKeys">
<b><code>LogFormat</code> Variable Keys</b><br>

<table border=1>
  <tr>
    <td><b><code>LogFormat</code> Variable</b></td>
    <td><b>Key</b></td>
  </tr>

  <tr>
    <td>&nbsp;<code>%A</code>&nbsp;</td>
    <td>anon_password</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%a</code>&nbsp;</td>
    <td>remote_ip</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%b</code>&nbsp;</td>
    <td>bytes_sent</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%c</code>&nbsp;</td>
    <td>connection_class</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%D</code>&nbsp;</td>
    <td>dir_path</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%d</code>&nbsp;</td>
    <td>dir_name</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%E</code>&nbsp;</td>
    <td>session_end_reason</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{<em>name</em>}e</code>&nbsp;</td>
    <td>ENV:<em>name</em></td>
  </tr>

  <tr>
    <td>&nbsp;<code>%F</code>&nbsp;</td>
    <td>transfer_path</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%f</code>&nbsp;</td>
    <td>file</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{file-modified}</code>&nbsp;</td>
    <td>file_modified</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%g</code>&nbsp;</td>
    <td>group</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{gid}</code>&nbsp;</td>
    <td>gid</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%H</code>&nbsp;</td>
    <td>server_ip</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%h</code>&nbsp;</td>
    <td>remote_dns</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%I</code>&nbsp;</td>
    <td>session_bytes_rcvd</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{iso8601}</code>&nbsp;</td>
    <td>timestamp</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%J</code>&nbsp;</td>
    <td>command_params</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%L</code>&nbsp;</td>
    <td>local_ip</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%l</code>&nbsp;</td>
    <td>identd_user</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%m</code>&nbsp;</td>
    <td>command</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{microsecs}</code>&nbsp;</td>
    <td>microsecs</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{millisecs}</code>&nbsp;</td>
    <td>millisecs</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{note:<em>name</em>}</code>&nbsp;</td>
    <td>NOTE:<em>name</em></td>
  </tr>

  <tr>
    <td>&nbsp;<code>%O</code>&nbsp;</td>
    <td>session_bytes_sent</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%P</code>&nbsp;</td>
    <td>pid</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%p</code>&nbsp;</td>
    <td>local_port</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{protocol}</code>&nbsp;</td>
    <td>protocol</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%r</code>&nbsp;</td>
    <td>raw_command</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%S</code>&nbsp;</td>
    <td>response_msg</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%s</code>&nbsp;</td>
    <td>response_code</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%T</code>&nbsp;</td>
    <td>transfer_secs</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%t</code>&nbsp;</td>
    <td>local_time</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{transfer-failure}</code>&nbsp;</td>
    <td>transfer_failure</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{transfer-status}</code>&nbsp;</td>
    <td>transfer_status</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%U</code>&nbsp;</td>
    <td>original_user</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%u</code>&nbsp;</td>
    <td>user</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{uid}</code>&nbsp;</td>
    <td>uid</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%V</code>&nbsp;</td>
    <td>server_dns</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%v</code>&nbsp;</td>
    <td>server_name</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%{version}</code>&nbsp;</td>
    <td>server_version</td>
  </tr>

  <tr>
    <td>&nbsp;<code>%w</code>&nbsp;</td>
    <td>rename_from</td>
  </tr>
</table>

connecting/disconnecting (boolean)

<p>
<hr>
Author: <i>$Author: tj $</i><br>
<hr>

<font size=2><b><i>
&copy; Copyright 2013 TJ Saunders<br>
 All Rights Reserved<br>
</i></b></font>

<hr>
</body>
</html>

